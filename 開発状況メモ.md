# ChatVault Clip 開発状況メモ

## プロジェクト概要
ChatVault Clipは、Web版LLMチャット（ChatGPT/Claude）の会話をワンクリックでObsidian VaultにMarkdownとして保存するChrome拡張機能です。既存のObsidian Web Clipperをベースに、AI チャット専用機能を追加しています。

## 現在の開発状況（2025-06-27時点）

### ✅ 完了済みフェーズ

#### フェーズ0: PoC実装（完了 2025-06-16）
- 基本的なコンテントスクリプト実装
- ChatGPT/Claude両対応のDOM抽出ロジック
- Markdown変換機能（Turndown使用）
- Obsidian URI連携
- ビルドシステム構築

#### フェーズ1: Vault直接保存機能（完了 2025-06-27）
- File System Access APIを使用した直接保存機能
- オプション画面にVaultフォルダ選択機能追加
- IndexedDBによるフォルダハンドル永続化
- 保存成功時の通知表示

#### フェーズ2: UI拡張実装（完了 2025-06-27）
- ChatModeSelector.js - 保存モード選択UI
- MarkdownPreview.js - プレビュー機能
- ダークモード対応
- キーボードショートカット実装
- 保存履歴表示
- テンプレートカスタマイズ機能

#### バグ修正（完了 2025-06-27）
- 保存ボタンクリック時の視覚的バグ修正
  - インラインスタイルからCSSクラスベースに変更
  - 適切なアニメーションとフィードバック実装

### 🔄 現在の状態

#### 動作確認済み機能
- **ChatGPT対応** ✅
  - メッセージ保存（単一/選択/最新N件/全体）
  - Web検索結果の保存
  - タスク機能での保存
  
- **Claude対応** ✅
  - 基本的なメッセージ保存（単一メッセージのみ）
  - ユーザー/アシスタントメッセージ両対応
  
- **保存方法** ✅
  - File System Access API（第一選択）
  - Chrome Downloads API
  - Obsidian URI（Advanced URI）
  - クリップボード（フォールバック）

#### 技術仕様
- **フレームワーク**: React 18.3.1 + Tailwind CSS
- **ビルドツール**: Webpack 5.92.1
- **拡張機能**: Manifest V3
- **対応ブラウザ**: Chrome 86+, Edge 86+, Arc 1.35+

### ⏳ 未実装機能（フェーズ3以降）

#### フェーズ3: Claude完全対応
- 複数保存モード実装
  - 選択範囲保存
  - 最新N件保存
  - 全体保存
- エッジケース対応
  - 長文メッセージの分割
  - 特殊文字のエスケープ

#### フェーズ4: 品質向上
- 国際化（i18n）対応
- アクセシビリティ向上
- 単体テスト/E2Eテスト実装

#### フェーズ5: リリース準備
- Chrome Web Store申請準備
- ドキュメント整備
- プライバシーポリシー作成

## 重要な技術的ポイント

### 1. 保存ボタンの実装
- メッセージ末尾にインライン配置
- CSS クラスベースの状態管理
- 32x32px固定サイズ
- 視覚的フィードバック（スピナー、チェック、エラー）

### 2. File System Access API
- Chrome 86+で利用可能
- IndexedDBでディレクトリハンドル永続化
- 権限の再確認処理実装

### 3. Claude特有の対応
- セレクタ: `[data-testid="user-message"]`、`[data-is-streaming]`
- インラインスタイルでの常時表示
- メッセージ抽出時のボタン一時削除処理

### 4. エラーハンドリング
- 複数の保存方法によるフォールバック
- 詳細なエラーログ出力
- ユーザーへの適切なフィードバック

## 今後の開発再開時の注意点

1. **環境確認**
   - `npm install` で依存関係をインストール
   - `npm run dev:chromium` で開発モード起動
   - Chrome拡張機能の開発者モードで`dist-chromium`フォルダを読み込み

2. **テスト手順**
   - ChatGPT (chatgpt.com) でメッセージ保存テスト
   - Claude (claude.ai) でメッセージ保存テスト
   - オプション画面でVaultフォルダ選択テスト

3. **デバッグ方法**
   - Content Script: DevToolsのConsoleタブ
   - Background Script: 拡張機能詳細から「サービスワーカー」をクリック
   - Popup: 拡張機能アイコン右クリック → 「ポップアップを検査」

## 関連ファイル
- `/開発プラン.md` - 詳細な開発計画とフェーズ別タスク
- `/DEBUG_LOG.md` - エラーと解決過程の詳細記録
- `/要件定義.md` - プロジェクトの要件定義
- `/CLAUDE.md` - 開発ガイドとベストプラクティス

---

**最終更新日**: 2025-06-27  
**最終作業内容**: 保存ボタンの視覚的バグ修正完了  
**次回作業予定**: フェーズ3（Claude完全対応）の実装