# Content Scripts

ウェブページに注入されるコンテンツスクリプトを含むディレクトリです。

## 概要

このディレクトリには、ChatGPTなどのチャットページに機能を注入するためのスクリプトが含まれています。ページのDOM操作、メッセージ抽出、UI拡張を担当します。

## ディレクトリ構造

### js/
JavaScriptファイル（メインロジック）
- **inject.js**: メインのコンテンツスクリプト（ページ注入のエントリーポイント）
- **providers/**: 各チャットサービスのプロバイダー
  - **chatgpt/**: ChatGPT専用のプロバイダー
  - **chatgpt.js**: ChatGPTプロバイダーの設定
  - **README.md**: プロバイダーの詳細ドキュメント
- **inject/**: ページ注入処理
  - **service.js**: インジェクションサービスのメインロジック
  - **ui.js**: UI要素の管理と操作
  - **README.md**: インジェクション処理の詳細ドキュメント
- **README.md**: JavaScriptロジックの詳細ドキュメント

### css/
スタイルシート（UIスタイル）
- **inject.css**: 注入されるCSSスタイル（UI要素のスタイリング）
- **README.md**: CSSスタイルの詳細ドキュメント

## 主要機能

### ページ注入処理
- **DOM監視**: ページ要素の変更検出
- **UI注入**: ボタンやオーバーレイの追加
- **イベント処理**: クリックやキー入力の監視
- **状態管理**: 注入状態の管理

### プロバイダーシステム
- **ChatGPT統合**: ChatGPTとのAPI通信
- **メッセージ抽出**: チャット履歴の取得
- **UI操作**: チャットインターフェースの制御
- **Markdown処理**: テキストのMarkdown変換

### スタイリング
- **UI要素**: 注入されるUIコンポーネントのスタイル
- **オーバーレイ**: モーダル、ツールチップのスタイル
- **アニメーション**: スムーズなトランジション効果
- **レスポンシブ**: 異なる画面サイズへの対応

## アーキテクチャ

```
contentScripts/
├── js/              # JavaScriptロジック
│   ├── providers/   # チャットサービスプロバイダー
│   ├── inject/      # ページ注入処理
│   └── inject.js    # メインエントリーポイント
└── css/             # スタイルシート
    └── inject.css   # UIスタイル
```

## 注入タイミング

- **ページ読み込み完了時**: 初期化処理
- **動的コンテンツ更新時**: 新しい要素の検出
- **ユーザーアクション時**: インタラクション処理

## セキュリティ考慮事項

- **CSP遵守**: Content Security Policyの遵守
- **XSS防止**: クロスサイトスクリプティング攻撃の防止
- **データ保護**: ユーザーデータの安全な処理
- **権限最小化**: 必要最小限の権限のみ要求

## 開発ガイドライン

- **パフォーマンス**: 効率的なDOM操作とメモリ管理
- **エラーハンドリング**: 適切なエラー処理とフォールバック
- **ブラウザ互換性**: 複数ブラウザでの動作保証
- **メンテナンス性**: 保守しやすいコード構造

## デバッグ

```javascript
// デバッグモードの有効化
window.DEBUG_MODE = true;

// ログ出力
console.log('[ContentScript] 注入完了');

// エラー処理
try {
  // 処理
} catch (error) {
  console.error('[ContentScript] エラー:', error);
}
```

## 注意事項

- ページの既存機能を妨害しないよう注意してください
- 異なるサイトでの互換性を考慮してください
- 適切なエラーハンドリングを実装してください
