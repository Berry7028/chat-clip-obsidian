# Chat Clip Obsidian 開発状況メモ (2025/06/20)

## プロジェクト概要
ChatVault ClipはChatGPTやClaudeの会話をワンクリックでObsidian VaultにMarkdownとして保存するChrome拡張機能。Obsidian Web Clipperをフォークして作成。

## 現在の実装状況

### ✅ 完了した機能
1. **基本機能**
   - ChatGPT/Claudeページへの保存ボタン自動追加
   - 単一メッセージの保存
   - 会話タイトルの自動取得
   - 日本語ファイル名のサポート
   - フロントマター付きMarkdown生成

2. **Web Clipper機能の削除**
   - 元のObsidian Web Clipper機能を完全に削除
   - AI チャット専用の拡張機能として特化
   - UIから不要な機能を除去

3. **エラー修正**
   - 初期化エラー（未定義変数参照）を修正
   - getSelectors関数名の不一致を修正
   - 依存性エラーの解決

### 🔄 現在の動作仕様

#### 保存フロー
1. チャットメッセージの保存ボタンをクリック
2. コンテンツがクリップボードにコピーされる
3. Obsidianが自動的に開く（新規ノート作成ダイアログ）
4. ユーザーが手動でCtrl/Cmd+Vでペースト
5. 「作成」ボタンをクリックして保存

#### ファイル構造
- 保存先: `{vault}/ChatVault/{SERVICE}/{date}_{time}_{service}_{title}.md`
- SERVICE: CHATGPT または CLAUDE
- 例: `ChatVault/CHATGPT/2025-06-20_17-19-04_chatgpt_記事構成提案.md`

### ⚠️ 既知の問題と制限

1. **Obsidian URIの制限**
   - `obsidian://new`の`content`パラメータが確実に動作しない
   - ファイルは作成されるが、内容が自動的に挿入されない
   - これはObsidian自体の仕様による制限

2. **Advanced URIプラグインの問題**
   - base64エンコードされたコンテンツが正しくデコードされない
   - 文字化けした内容が保存される
   - プラグインの設定やバージョンによる互換性の問題

3. **手動ペーストが必要**
   - 現在の実装では、クリップボード経由が最も確実
   - ただし、ユーザーが手動でペーストする必要がある
   - 自動化は現時点では困難

### 📋 技術的詳細

#### URI長さの制限
- ブラウザのURI長さ制限: 約8000文字
- 日本語はURIエンコードで3倍になることがある
- 長いコンテンツは必ずクリップボード経由になる

#### デバッグログ
拡張機能は詳細なコンソールログを出力：
- `[ChatVault Background]`: バックグラウンドスクリプトのログ
- `[ChatVault]`: コンテントスクリプトのログ
- URI長さ、エンコード方法、保存方法などの詳細情報

### 🚀 今後の改善案

1. **Obsidian側の改善待ち**
   - Obsidian公式がURI schemeを改善すれば自動保存が可能に
   - Advanced URIプラグインの更新による互換性向上

2. **代替アプローチ**
   - Obsidian APIを使った直接的なファイル作成
   - ローカルファイルシステムへの直接書き込み（要権限）
   - Obsidian Sync APIの活用

3. **UX改善**
   - より分かりやすいユーザーガイド
   - ペースト手順の視覚的な説明
   - エラー時のフォールバック改善

### 📝 開発メモ

- **フォーク元**: https://github.com/mvavassori/obsidian-web-clipper
- **主要変更**: Web Clipper機能を削除し、AI チャット専用に特化
- **ビルドコマンド**: `npm run build:chromium`
- **テスト環境**: Chrome/Edge + Obsidian (Advanced URIプラグイン有/無)

## まとめ

現時点では、技術的制限により完全な自動保存は実現できていないが、クリップボード経由での保存は安定して動作している。Obsidian側のURI scheme改善、またはAdvanced URIプラグインの更新により、将来的には完全自動化が可能になる見込み。

ユーザーにとっては手動ペーストが必要だが、以下の利点がある：
- 確実にコンテンツが保存される
- ファイル名や保存場所は自動設定
- フロントマター付きの整形されたMarkdown
- 日本語対応

---
*最終更新: 2025/06/20 17:30*